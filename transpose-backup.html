<!doctype html>
<html>
	<head>
		<meta charset="utf-8">
		<title>Transpose</title>
		<style>
			* {
			font-family: Calibri, Arial, sans-serif;
			}
			
			textarea {
			height: 500px;
			width: 1000px;
			font-family: monospace;
			font-size: 1.5em;
			}
			
			button {
			font-size: 2em;
			padding: 20px;
			width: 500px;
			}
		</style>
	</head>
	<body>
		<textarea id="ta">None Like You

F          Csus4        Dm
There is none like you
Bb        F                C7
No one else can touch my heart like you do
F      C         Dm        Bb
I can search for all eternity long
   Dmin        C       Bb    Fmaj
And find there is none like you</textarea><br><button type="button" onclick="transpose(true);">↑</button><button type="button" onclick="transpose(false);">↓</button>
		<script>
			var ta = document.getElementById("ta");
			var arrFlat	=	["Cb",	"Db",	"Eb",	"Fb",	"Gb",	"Ab",	"Hb",	"Ax",	"Hx",	"Ex"];
			var arrSharp=	[" H",	"Cx",	"Dx",	"E",	"Fx",	"Gx",	"Bb",	"Bb",	" C",	" F"];
			var arrFrom	=	["Cx",	" C",	"Dx",	" D",	" E",	"Fx",	" F",	"Gx",	" G",	" A",	"Bb",	" H"];
			var arrTo	=	["P",	"O",	"R",	"Q",	"S",	"U",	"T",	"W",	"V",	"X",	"Y",	"Z"];
			var arrUp	=	[" D",	"Cx",	" E",	"Dx",	" F",	" G",	"Fx",	" A",	"Gx",	"Bb",	" H",	" C"];
			var arrDown	=	[" C",	" H",	" D",	"Cx",	"Dx",	" F",	" E",	" G",	"Fx",	"Gx",	" A",	"Bb"];
			//var hint	=	["1",	"0",	"3",	"2",	"4",	"6",	"5",	"8",	"7",	"9",	"10",	"11"];
			function transpose(upY) {
				var song = ta.value.split("\n");
				for(var j = 0; j < song.length; j++) {
					if(areChords(song[j])) {
						song[j] = song[j].replace(/#/g, "x");
						var chords = song[j].split(/\b/);
						for(var k = 0; k < chords.length; k++) {
							if(chords[k].replace(/\s+/, "") == "") {
								if(chords[k].replace(/\s\s+/, "") == "") {
									chords[k] = chords[k].slice(1);
								}
								else if(k == 0) {
									chords[k] = "";
									console.log(k);
								}
							}
							else {
								chords[k] = chords[k].replace(/([ACDEFGH])is/g, "$1#").replace(/([ACDEFGH])es/g, "$1b");
								for(var i = 0; i < arrFlat.length; i++) {
									var regex = new RegExp(arrFlat[i], "g");
									chords[k] = chords[k].replace(regex, arrSharp[i]);
								}
								chords[k] = chords[k].replace(/([ABCDEFGH][#b]?)-/g, "$1m");
								
								//if(chords[k].indexOf("#") == -1 && chords[k].indexOf("Bb") == -1) {chords[k] = " "+chords[k];}
								chords[k] = " "+chords[k];
								for(var i = 0; i < arrFrom.length; i++) {
									var regex = new RegExp(arrFrom[i], "g");
									chords[k] = chords[k].replace(regex, arrTo[i]);
								}
								for(var i = 0; i < arrFrom.length; i++) {
									var regex = new RegExp(arrTo[i], "g");
									if(upY) {
										chords[k] = chords[k].replace(regex, arrUp[i]);
									}
									else {
										chords[k] = chords[k].replace(regex, arrDown[i]);
									}
								}
							}
						}
						song[j] = chords.join("").replace(/x/g, "#");
					}
				}
				ta.value = song.join("\n");
			}
			
			/*function normalize() {
				var song = ta.value.split("\n");
				for(var j = 0; j < song.length; j++) {
				if(areChords(song[j])) {
				song[j] = song[j].replace(/([ACDEFGH])is/g, "$1#").replace(/([ACDEFGH])es/g, "$1b");
				for(var i = 0; i < arrFlat.length; i++) {
				var regex = new RegExp(arrFlat[i], "g");
				song[j] = song[j].replace(regex, arrSharp[i]);
				}
				song[j] = song[j].replace(/([ABCDEFGH][#b]?)mi[n]?/g, "$1m").replace(/([ABCDEFGH][#b]?)-/g, "$1m");
				}
				}
				ta.value = song.join("\n");
			}*/
			
			function areChords(line) {
				var missing = ".,cefhkopqrvwxyzIJKLMNOPQRSTUVWXYZ";
				var sum = 0;
				for(var i = 0; i < missing.length; i++) {
					sum += line.indexOf(missing[i]);
				}
				if (sum + missing.length == 0) {
					return true;
				}
				else {
					return false;
				}
			}
		</script>
	</body>
</html>